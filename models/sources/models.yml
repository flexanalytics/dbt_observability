version: 2

models:
  - name: models
    description: Dimension that contains data about models.
    columns:
    - name: command_invocation_id
      description: '{{ doc("command_invocation_id") }}'
    - name: node_id
      description: '{{ doc("node_id") }}'
    - name: run_started_at
      description: '{{ doc("run_started_at") }}'
    - name: database_name
      description: '{{ doc("database_name") }}'
    - name: schema_name
      description: '{{ doc("schema_name") }}'
    - name: name
      description: '{{ doc("name") }}'
    - name: depends_on_nodes
      description: '{{ doc("depends_on_nodes") }}'
    - name: package_name
      description: '{{ doc("package_name") }}'
    - name: path
      description: '{{ doc("path") }}'
    - name: checksum
      description: '{{ doc("checksum") }}'
    - name: materialization
      description: '{{ doc("materialization") }}'
    - name: tags
      description: '{{ doc("tags") }}'
    - name: meta
      description: '{{ doc("meta") }}'
    - name: description
      description: ''
      meta:
        label: Description
    - name: total_rowcount
      description: 'Total rowcount for the model'

metrics:
  - name: table_count
    label: Table Count
    model: ref('models')
    description: "A `distinct_count` of tables"
    type: count_distinct
    sql: node_id
    timestamp: run_started_at
    filters:
      - field: materialization
        operator: '!='
        value: 'view'
        
  - name: view_count
    label: View Count
    model: ref('models')
    description: "A `distinct_count` of views"
    type: count_distinct
    sql: node_id
    timestamp: run_started_at
    filters:
      - field: materialization
        operator: 'is'
        value: 'view'
